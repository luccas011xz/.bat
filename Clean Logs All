@echo off
>nul 2>&1 fltmc || (PowerShell Start -Verb RunAs '%0' 2> nul || exit /b 1)
setlocal EnableExtensions DisableDelayedExpansion

PowerShell -ExecutionPolicy Unrestricted -Command "$pathGlobPattern = \"$($directoryGlob = '%APPDATA%\Microsoft\Windows\Recent\AutomaticDestinations'; if ($directoryGlob.EndsWith('\*')) { $directoryGlob } elseif ($directoryGlob.EndsWith('\')) { \"$($directoryGlob)*\" } else { \"$($directoryGlob)\*\" } )\"; $expandedPath = [System.Environment]::ExpandEnvironmentVariables($pathGlobPattern); $foundAbsolutePaths = @(); try { $foundAbsolutePaths += @( Get-ChildItem -Path $expandedPath -Force -Recurse -ErrorAction SilentlyContinue | Select-Object -ExpandProperty FullName ); } catch {}; try { $foundAbsolutePaths += @( Get-Item -Path $expandedPath -ErrorAction SilentlyContinue | Select-Object -ExpandProperty FullName ); } catch {}; $foundAbsolutePaths = $foundAbsolutePaths | Select-Object -Unique; if ($foundAbsolutePaths) { foreach ($path in $foundAbsolutePaths) { if (Test-Path $path) { Remove-Item -Path $path -Force -Recurse -ErrorAction SilentlyContinue } } }" >nul 2>&1

PowerShell -ExecutionPolicy Unrestricted -Command "$pathGlobPattern = \"$($directoryGlob = '%APPDATA%\Microsoft\Windows\Recent\CustomDestinations'; if ($directoryGlob.EndsWith('\*')) { $directoryGlob } elseif ($directoryGlob.EndsWith('\')) { \"$($directoryGlob)*\" } else { \"$($directoryGlob)\*\" } )\"; $expandedPath = [System.Environment]::ExpandEnvironmentVariables($pathGlobPattern); $foundAbsolutePaths = @(); try { $foundAbsolutePaths += @( Get-ChildItem -Path $expandedPath -Force -Recurse -ErrorAction SilentlyContinue | Select-Object -ExpandProperty FullName ); } catch {}; try { $foundAbsolutePaths += @( Get-Item -Path $expandedPath -ErrorAction SilentlyContinue | Select-Object -ExpandProperty FullName ); } catch {}; $foundAbsolutePaths = $foundAbsolutePaths | Select-Object -Unique; if ($foundAbsolutePaths) { foreach ($path in $foundAbsolutePaths) { if (Test-Path $path) { Remove-Item -Path $path -Force -Recurse -ErrorAction SilentlyContinue } } }" >nul 2>&1

reg delete "HKCU\Software\Microsoft\Windows\CurrentVersion\Applets\Regedit" /va /f >nul 2>&1
reg delete "HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Applets\Regedit" /va /f >nul 2>&1
reg delete "HKCU\Software\Microsoft\Windows\CurrentVersion\Applets\Regedit\Favorites" /va /f >nul 2>&1
reg delete "HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Applets\Regedit\Favorites" /va /f >nul 2>&1
reg delete "HKCU\Software\Microsoft\Windows\CurrentVersion\Explorer\ComDlg32\LastVisitedPidlMRU" /va /f >nul 2>&1
reg delete "HKCU\Software\Microsoft\Windows\CurrentVersion\Explorer\ComDlg32\LastVisitedPidlMRULegacy" /va /f >nul 2>&1
reg delete "HKCU\Software\Adobe\MediaBrowser\MRU" /va /f >nul 2>&1
reg delete "HKCU\Software\Microsoft\Windows\CurrentVersion\Applets\Paint\Recent File List" /va /f >nul 2>&1
reg delete "HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Applets\Paint\Recent File List" /va /f >nul 2>&1
reg delete "HKCU\SOFTWARE\Microsoft\Windows\CurrentVersion\Applets\Wordpad\Recent File List" /va /f >nul 2>&1
reg delete "HKCU\Software\Microsoft\Windows\CurrentVersion\Explorer\Map Network Drive MRU" /va /f >nul 2>&1
reg delete "HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\Map Network Drive MRU" /va /f >nul 2>&1
reg delete "HKCU\Software\Microsoft\Search Assistant\ACMru" /va /f >nul 2>&1
reg delete "HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\RecentDocs" /va /f >nul 2>&1
reg delete "HKCU\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\RecentDocs" /va /f >nul 2>&1
reg delete "HKCU\Software\Microsoft\Windows\CurrentVersion\Explorer\ComDlg32\OpenSaveMRU" /va /f >nul 2>&1
reg delete "HKCU\Software\Microsoft\MediaPlayer\Player\RecentFileList" /va /f >nul 2>&1
reg delete "HKCU\Software\Microsoft\MediaPlayer\Player\RecentURLList" /va /f >nul 2>&1
reg delete "HKLM\SOFTWARE\Microsoft\MediaPlayer\Player\RecentFileList" /va /f >nul 2>&1
reg delete "HKLM\SOFTWARE\Microsoft\MediaPlayer\Player\RecentURLList" /va /f >nul 2>&1
reg delete "HKCU\Software\Microsoft\Direct3D\MostRecentApplication" /va /f >nul 2>&1
reg delete "HKLM\SOFTWARE\Microsoft\Direct3D\MostRecentApplication" /va /f >nul 2>&1
reg delete "HKCU\Software\Microsoft\Windows\CurrentVersion\Explorer\RunMRU" /va /f >nul 2>&1
reg delete "HKCU\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\TypedPaths" /va /f >nul 2>&1

wevtutil el | foreach {wevtutil cl "$_"} >nul 2>&1
PowerShell -Command "$bin = (New-Object -ComObject Shell.Application).NameSpace(10); $bin.items() | ForEach { Remove-Item $_.Path -Recurse -Force }" >nul 2>&1

endlocal
exit /b 0
